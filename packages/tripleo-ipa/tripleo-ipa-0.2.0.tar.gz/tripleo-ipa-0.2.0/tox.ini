[tox]
minversion = 2.0
# add docs to the list of environments once we actually have docs to generate
envlist = py36,pep8,molecule,linters
skipdist = True

[testenv]
usedevelop = True
install_command = pip install -c{env:UPPER_CONSTRAINTS_FILE:https://opendev.org/openstack/requirements/raw/branch/master/upper-constraints.txt} {opts} {packages}
passenv = *
sitepackages = True
deps =
   -r {toxinidir}/requirements.txt
   -r {toxinidir}/ansible-requirements.txt
   -r {toxinidir}/test-requirements.txt
commands = stestr run {posargs}
whitelist_externals =
  tox

[testenv:molecule]
setenv =
  ANSIBLE_FILTER_PLUGINS={toxinidir}/tripleo_ipa/ansible_plugins/filter
  ANSIBLE_LIBRARY={toxinidir}/tripleo_ipa/roles.galaxy/config_template/library:{toxinidir}/tripleo_ipa/ansible_plugins/modules
  ANSIBLE_ROLES_PATH={toxinidir}/tripleo_ipa/roles.galaxy:{toxinidir}/tripleo_ipa/roles
deps =
   -r {toxinidir}/requirements.txt
   -r {toxinidir}/molecule-requirements.txt
changedir = {toxinidir}/tripleo_ipa
commands = molecule test --all

[testenv:ansible-lint]
deps = {[testenv:linters]deps}
commands =
  ansible-lint {toxinidir}/tripleo_ipa

[testenv:yamllint]
deps = {[testenv:linters]deps}
commands =
  yamllint -c {toxinidir}/tripleo_ipa/.yamllint {toxinidir}/tripleo_ipa

[testenv:linters]
deps =
   -r {toxinidir}/test-requirements.txt
commands =
  {[testenv:ansible-lint]commands}
  {[testenv:yamllint]commands}

[testenv:pep8]
envdir = {toxworkdir}/linters
commands =
    python -m pre_commit run flake8 -a
